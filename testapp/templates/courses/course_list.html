{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>الدورات التدريبية | المعهد السعودي المتخصص</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Cairo', sans-serif; 
            padding: 20px; 
            text-align: center;
            min-height: 100vh;
            background-color: #f4f7f6;
            overflow-x: hidden;
        }

        /* الخلفية المائية للمعهد */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('{% static "bg.jpg" %}'); 
            background-size: cover;
            background-position: 80% center; /* نفس مكان الامتحانات */
            opacity: 0.10;
            z-index: -1;
        }

        h1 { color: #006c35; margin-bottom: 30px; font-weight: 700; font-size: 2.5em; }

        /* البطاقات */
        .course-card { 
            padding: 30px; 
            background: white; 
            margin-bottom: 25px; 
            border-radius: 15px; 
            border: 1px solid #ddd; 
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            max-width: 800px;
            margin-left: auto; margin-right: auto;
            position: relative;
        }

        .highlight { 
            border: 3px solid #006c35; 
            transform: scale(1.03);
            box-shadow: 0 10px 30px rgba(0, 108, 53, 0.2);
            background-color: #fff;
        }

        h2 { color: #333; margin: 0 0 10px 0; }
        p { color: #666; font-size: 1.1em; }

        /* تعليمات المكفوفين */
        .blind-instructions {
            background: #333; color: #fff; padding: 15px; border-radius: 8px;
            margin-bottom: 30px; font-size: 1.1em; border-right: 5px solid gold;
        }
        audio { display: none; }
    </style>
</head>
<body>

    <div class="blind-instructions" id="welcome-msg">
        أهلاً بك في قسم التدريب. اضغط "مسافة" للتنقل بين الدورات المتاحة، و"إنتر" للدخول للدورة.
    </div>

    <h1>الدورات التدريبية المتاحة</h1>

    <div id="courses-container">
        {% for course in courses %}
            <div class="course-card" id="course-{{ forloop.counter0 }}" data-url="{% url 'course_detail' course.id %}">
                {% if course.icon %}
                    <img src="{{ course.icon.url }}" alt="" style="width: 60px; height: 60px; margin-bottom: 10px;">
                {% endif %}
                
                <h2>{{ course.title }}</h2>
                <p>{{ course.description|truncatewords:20 }}</p>
                
                {% if course.audio_file %}
                    <audio id="audio-{{ forloop.counter0 }}" src="{{ course.audio_file.url }}"></audio>
                {% endif %}
            </div>
        {% empty %}
            <div class="course-card">
                <p>لا توجد دورات متاحة حالياً.</p>
            </div>
        {% endfor %}
    </div>

    <script>
        // --- محرك الصوت والتنقل ---
        const cards = document.querySelectorAll('.course-card');
        let currentIndex = -1;

        window.onload = function() {
            setTimeout(() => {
                let msg = document.getElementById('welcome-msg').innerText;
                speakSimple(msg);
            }, 800);
        };

        function speakSimple(text) {
            window.speechSynthesis.cancel();
            window.utterance = new SpeechSynthesisUtterance(text);
            window.utterance.lang = 'ar-SA';
            window.speechSynthesis.speak(window.utterance);
        }

        function stopAllAudio() {
            document.querySelectorAll('audio').forEach(a => { a.pause(); a.currentTime = 0; });
            window.speechSynthesis.cancel();
        }

        function playCardAudio(index) {
            let audio = document.getElementById(`audio-${index}`);
            if (audio) {
                audio.currentTime = 0;
                audio.play();
            } else {
                speakSimple("هذه الدورة لا تحتوي على ملف صوتي");
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                event.preventDefault();
                stopAllAudio();
                
                if (currentIndex >= 0 && currentIndex < cards.length) cards[currentIndex].classList.remove('highlight');
                
                currentIndex++;
                if (currentIndex >= cards.length) {
                    currentIndex = 0;
                    speakSimple("بداية القائمة");
                    setTimeout(() => highlightAndPlay(currentIndex), 1200);
                } else {
                    highlightAndPlay(currentIndex);
                }
            }

            if (event.code === 'Enter') {
                if (currentIndex >= 0) {
                    stopAllAudio();
                    speakSimple("جاري فتح الدورة...");
                    let url = cards[currentIndex].getAttribute('data-url');
                    setTimeout(() => { window.location.href = url; }, 1000);
                }
            }
        });

        function highlightAndPlay(index) {
            let card = cards[index];
            card.classList.add('highlight');
            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            playCardAudio(index);
        }
    </script>
</body>
</html>